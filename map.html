<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Map of Solar Recycling Sites</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
<header>
  <h1>Interactive Map of Solar Recycling Sites</h1>
  <nav><a href="index.html">← Back to Home</a></nav>
</header>

<main>
  <div id="map" aria-label="Map showing solar recycling sites"></div>
  <div id="verification-info">
    To suggest corrections or provide additional information, email 
    <a href="mailto:solarrecyclingnetwork@gmail.com">solarrecyclingnetwork@gmail.com</a>.
  </div>
</main>

<script>
// Initialize map
const map = L.map('map').setView([37.5, -95], 4);
const bounds = [];

// Tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

// Marker icons
const greenIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
  iconSize: [25,41],
  iconAnchor: [12,41],
  popupAnchor: [1,-34],
  shadowSize: [41,41]
});
const grayIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png',
  iconSize: [25,41],
  iconAnchor: [12,41],
  popupAnchor: [1,-34],
  shadowSize: [41,41]
});

// Load sites.json dynamically
fetch('sites.json')
  .then(response => response.json())
  .then(sites => {
    sites.forEach(site => {
      const marker = L.marker([site.lat, site.lng], {
        icon: site.processVerified ? greenIcon : grayIcon
      }).addTo(map);

      marker.bindPopup(`
        <b>${site.location}</b><br>
        ${site.address}<br>
        <strong>Facility Type:</strong> ${site.facilityType}<br>
        <strong>Status:</strong> ${site.processVerified ? "Verified" : "Process Not Verified"}<br>
        <a href="${site.website}" target="_blank" rel="noopener noreferrer">Website</a><br>
        <em>Last checked: ${site.dateLastChecked}</em>
      `), { className: 'custom-popup' });

      bounds.push([site.lat, site.lng]);
    });

    if(bounds.length > 0){
      map.fitBounds(bounds, { padding: [50,50] });
    }
  })
  .catch(err => console.error('Failed to load sites.json:', err));

// Legend
const legend = L.control({position:"bottomright"});
legend.onAdd = function(){
  const div = L.DomUtil.create("div","legend");
  div.innerHTML = `
    <h4>Legend</h4>
    <p><img src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png"> Verified</p>
    <p><img src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png"> Process Not Verified</p>
  `;
  return div;
};
legend.addTo(map);
</script>
</body>
</html>
